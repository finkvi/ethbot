## Telegram Bot + Ethereum 

Бот - договорщик по складчинам. Умная машина гарант сервиса.

## Постановка задачи и допущения

1. Есть группа людей, которые хотят собрать деньги (скинуться) на покупку чего-либо
2. Каждый из них не доверяет другому, не доверяет и стороннему сервису (в нашем случае telegram боту)
3. Каждый готов довериться технологии blockchain, если она будет «прозрачно» использоваться сторонним сервисом. Под прозрачностью понимается возможность самостоятельной проверки каждым результатов функционирования сервиса
4. Каждый представляет на базовом уровне, что есть криптовалюта Ethereum, имеет свой кошелёк и умеет осуществлять транзакции
5. Процесс такого рода здесь и далее называется "складчиной". Это НЕ краудфайдинг, далее будут видны принципиальные отличия

## Идея реализации

- Группа людей создает групповой чат в Telegram, например, «Сбор денег на обучение»
- Любой участник добавляет в него бота @EthGarant_bot и запускает его /start
- Бот ведет диалог открыто в чате с каждым участником и организует сбор и перевод средств
- Инструментом является среда Ethereum. Бот, на основании ответов участников чата, формирует начальные требования (параметры) умного контракта. Затем публикует контракт в блокчейн Ethereum и даёт возможность непосредственно в чате просмотреть состояние контракта
- На каждом этапе любой участник чата может проверить с использованием сторонних средст (https://etherscan.io/, локального кошелька Ethereum Wallet, любых других) результат работы бота и транзакций от участников чата
- Сам бот имеет открытый исходный код. Параноики могут самостоятельно сделать его форк и запустить на своих мощностях
- Бот, конечно же, не хранит параметры доступа к кошелькам участников. Для истории бот хранит переписку чата, доступную для него, в своей базе данных

## Детали умного контракта
- Круг участников должен быть определен до первой транзакции. Это значит, что бот опросит всех по очереди и попросит сказать «Да/Нет» на вопрос об участии в складчине
- Транзакции от «незарегистрированных» участников идут в пользу бота и не учитываются в складчине
- Транзакции больше необходимой суммы учитываются как необходимая сумма, остальное идет в пользу бота
- Если хотя бы один участник не производит оплату или делает её частичной в заданное время, контракт возвращает средства всем заплатившим участникам (за исключением переплат), кроме частичных средств не выполнившего условия участника
- Так как владельцем контракта, а следовательно и его публикатором является бот, то и топливо на его публикацию списывается с кошелька бота. Это не очень хорошо, так как если участники складчины не допускают ошибок, бот остается в маленьком минусе при успешном завершении складчины и в чуть большем минусе при неуспешном (топливо на возврат транзакций). Здесь можно поступить несколькими способами, сделаем самый верный, будем брать на бензин с кошелька, на который упадет вся сумма складчины после её завершения(это один из участников, которого так же определит бот). Как только получили на бензин, начинаем исполнение контракта

## Сценарий использования

Пример успешного (когда складчина собрала необходимые деньги) чата можно посмотреть [здесь](https://github.com/finkvi/ethbot/blob/master/presentation/ExampleYes.pdf)

## Технологии
- Node JS (Telegram Bot + node-telegram-bot-api) для написания бота
- Node JS (Ethereum + web3) для взаимодействия с блокчейном
- Solidity язык умных контрактов
- Среда разработки для Node JS: https://c9.io
- Среда разработки для Solidty: https://remix.ethereum.org
- Локальный кошелек: Ethereum Wallet
- Web кошелек: https://www.myetherwallet.com
- Посмотреть, что происходит в блокчейне здесь: https://etherscan.io/
- Тестовая сеть здесь: https://etherscan.io/

## Установка (проверено на Digital Ocean):
Создаем стандартный дроплет NodeJS 6.10.1 on Ubuntu 16.04 за 5$, заводим sudo юзера, апгрейдимся

```sh
apt-get upgrade -y
```

- Устанавливаем мускуль по статье здесь: https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-14-04

- Устанавливаем phpMyAdmin по этой статье: https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-phpmyadmin-on-ubuntu-14-04

- Устанавливаем сертификат от https://letsencrypt.org/getting-started/, необходим для телеграмма, он может работать только по https, делаем по статье отсюда https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-16-04

- Устанавливаем git и клонируем проект
```sh
git clone https://github.com/finkvi/ethbot/
```
- Импортируем структуру базы данных phpMyAdmin, файл [отсюда](https://github.com/finkvi/ethbot/blob/master/deploy/botdb_create_struct.sql)

- Установка зависимостей Node JS
```sh
npm install ethereumjs-tx
npm install web3
npm install mysql
npm install node-telegram-bot-api
```

## License
MIT
